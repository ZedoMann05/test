name: Update branches

on:
  workflow_dispatch:
    # branches:
    #   - development
    #   - staging

jobs:
  update-branches:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ssh-key: ${{ secrets.DEPLOY_SSH_KEY }}
        
      - name: Backup target branch
        run: |
          git fetch origin ${{ github.ref_name }}
          git fetch origin main
          git checkout ${{ github.ref_name }}
          git pull origin ${{ github.ref_name }}
          git checkout -b "backup/${{ github.ref_name }}"
          git push origin "backup/${{ github.ref_name }}"
          
      - name: Reset target branch to master
        run: |
          git checkout main
          git pull origin main
          git checkout ${{ github.ref_name }}
          git reset --hard "origin/main"
          git push --force origin ${{ github.ref_name }}
          
    #   - name: Create and merge topic branches
    #     run: |
    #       # Assuming you have a script to create and merge topic branches
    #       # Replace the command below with the actual script
    #       ./scripts/create_and_merge_topics.sh
        
    #   - name: Get list of tasks from YouTrack
    #     run: |
    #       # Assuming you have a script to fetch tasks from YouTrack
    #       # Replace the command below with the actual script
    #       ./scripts/get_tasks_from_youtrack.sh
          
    #   - name: Send report to Slack
    #     env:
    #       SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
    #     run: |
    #       # Assuming you have a script to format and send report to Slack
    #       # Replace the command below with the actual script
    #       ./scripts/send_report_to_slack.sh
