name: Check commit

on:
  workflow_call:

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Fetch base branch
      run: git fetch origin ${{ github.event.pull_request.base.ref }}
      
    - name: Fetch head branch
      run: git fetch origin ${{ github.event.pull_request.head.ref }}
      
    - name: Get base branch SHA
      id: base_sha
      run: echo "::set-output name=sha::$(git rev-parse origin/${{ github.event.pull_request.base.ref }})"
        
    - name: Get head branch SHA
      id: head_sha
      run: echo "::set-output name=sha::$(git rev-parse origin/${{ github.event.pull_request.head.ref }})"
        
    - name: Validate Commits
      run: |
        base_sha="${{ steps.base_sha.outputs.sha }}"
        head_sha="${{ steps.head_sha.outputs.sha }}"
        
        # –ó–¥—ñ–π—Å–Ω—é—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∫–æ–º—ñ—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤–∏—Ä–∞–∑—É
        if git log -1 --format=%B $base_sha..$head_sha | grep -E '^(fix|hotfix|bugfix|feat|feature|breaking)((.+))?:.+'; then
          echo "üü¢ There are valid commits according to regulation."
          exit 0
        else
          echo "üî¥ There is no commits that are valid according to regulation"
          exit 1
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    # - name: Post comment on Pull Request
    #   if: ${{ always() }}
    #   uses: thollander/actions-comment-pull-request@v2
    #   with:
    #     message: |
    #       ${{ steps.validate.outputs.validation_result }} There are valid commits according to regulation.