name: Check commit

on:
  workflow_call:

jobs:
  check_commit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: check commit
      run: |
        invalid_commits=0
        while IFS= read -r commit; do
          if ! echo "$commit" | grep -qE "(fix|hotfix|bugfix|feat|feature|breaking)((.+))?:.+"; then
            invalid_commits=$((invalid_commits+1))
          fi
        done < <(git log --format="%s" ${{ github.event.before }}..${{ github.sha }})
        if [ $invalid_commits -eq 0 ]; then
          echo "::set-output name=validation_result::valid"
        else
          echo "::set-output name=validation_result::invalid"
        fi