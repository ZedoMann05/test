name: Check commit

on:
  workflow_call:

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Validate Commit
      run: |
        # ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº SHA ÐºÐ¾Ð¼Ñ–Ñ‚Ñ–Ð², ÑÐºÑ– Ð²Ñ–Ð´ÑÑƒÑ‚Ð½Ñ– Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ñ–
        git fetch origin ${{ github.head_ref }}
    
        # ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ SHA Ð¾ÑÑ‚Ð°Ð½Ð½ÑŒÐ¾Ð³Ð¾ ÐºÐ¾Ð¼Ñ–Ñ‚Ñƒ, Ñ‰Ð¾ Ð±ÑƒÐ² Ð´Ð¾Ð´Ð°Ð½Ð¸Ð¹ Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð¿ÑƒÑˆÑƒ
        head_sha=$(git log --format=%H origin/${{ github.head_ref }}..HEAD | tail -n 1)
    
        # ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð´Ð»Ñ Ð³Ñ–Ð»ÐºÐ¸ (Ð²Ð¸Ð´Ð°Ð»ÑÑ”Ð¼Ð¾ "refs/heads/")
        branch_pattern=$(echo ${{ github.head_ref }} | grep -oE '\/([a-zA-Z0-9_-]+)\/' | cut -d'/' -f2)
    
        # ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸ Ð¾ÑÑ‚Ð°Ð½Ð½Ñ–Ð¹ ÐºÐ¾Ð¼Ñ–Ñ‚ Ð½Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ñ–ÑÑ‚ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ
        if git log -1 --format=%B $head_sha | grep -E "^(fix|hotfix|bugfix|feat|feature|breaking)\($branch_pattern\)?:.+"; then
          echo "# Validate Commit" > ./report.md
          echo "Your commit - $(git log -1 --format=%B $head_sha)" >> ./report.md
          echo "ðŸŸ¢ There are valid commits according to regulation." >> ./report.md
          exit 0
        else
          echo "# Validate Commit" > ./report.md
          echo "Your commit - $(git log -1 --format=%B $head_sha)" >> ./report.md
          echo "ðŸ”´ There are no valid commits according to regulation." >> ./report.md
          exit 1
        fi
    
    
    - name: Post report as comment
      if: ${{ always() }}
      uses: thollander/actions-comment-pull-request@v2
      with:
        filePath: ./report.md