name: Check commit

on:
  workflow_call:

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
        
    - name: Validate Commits
      run: |
        git fetch origin ${{ github.event.pull_request.head.ref }}
        
        head_sha=$(git rev-parse origin/${{ github.event.pull_request.head.ref }})
        
        branch_pattern=$(echo ${{ github.event.pull_request.head.ref }} | grep -oE '\/([a-zA-Z0-9_-]+)\/' | cut -d'/' -f2)

        # Ð¤Ñ–Ð»ÑŒÑ‚Ñ€ÑƒÑ”Ð¼Ð¾ ÐºÐ¾Ð¼Ñ–Ñ‚Ð¸ Ð»Ð¸ÑˆÐµ Ð·Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¾Ð¼ (ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ÐµÐ¼ GitHub)
        if git log --author="${{ github.actor }}" --format=%B $head_sha | grep -E "^(fix|hotfix|bugfix|feat|feature|breaking)\($branch_pattern\)?:.+"; then
          echo "# Validate Commit" > ./report.md
          echo "Your commit - $(git log --format=%B $head_sha)" >> ./report.md
          echo "ðŸŸ¢ There are valid commits according to regulation." >> ./report.md
          exit 0
        else
          echo "# Validate Commit" > ./report.md
          echo "Your commit - $(git log --format=%B $head_sha)" >> ./report.md
          echo "ðŸ”´ There is no commits that are valid according to regulation" >> ./report.md
          exit 1
        fi
    
    - name: Post comment on Pull Request
      if: ${{ always() }}
      uses: thollander/actions-comment-pull-request@v2
      with:
        filePath: ./report.md
