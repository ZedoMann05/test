name: Check commit

on:
  workflow_call:

jobs:
  check_commit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: check commit
      run: |
        last_commit_message=$(git show -s --format="%s" ${{ github.sha }})
        if ! echo "$last_commit_message" | grep -qE "(fix|hotfix|bugfix|feat|feature|breaking)((.+))?:.+"; then
          echo "::set-output name=validation_result::invalid"
        else
          echo "::set-output name=validation_result::valid"
        fi
    
    - name: Post comment on Pull Request
      if: github.event.pull_request.draft == false
      uses: actions/github-script@v4
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const result = process.env.VALID_COMMITS_RESULT;
          const message = result === 'valid' ? 'ðŸŸ¢ There are valid commits according to regulation.' : 'ðŸ”´ There is no commits that are valid according to regulation';
          const octokit = github.getOctokit(process.env.GITHUB_TOKEN);
          await octokit.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
            body: message
          });